<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!--
    CrestApps.OrchardCore.AgentSkills
    Copies agent skill / guardrail files from the NuGet package into
    the consuming project's .agents/ folder on restore and install.
    Files are always refreshed so that package updates are applied immediately.
    This target does NOT depend on compilation.
  -->

  <PropertyGroup>
    <!-- Source: the skills content shipped inside the NuGet package -->
    <_CrestAppsAgentSource>$(MSBuildThisFileDirectory)..\contentFiles\any\any\.agents\</_CrestAppsAgentSource>

    <!-- Target: the consuming project's .agents/ folder -->
    <_CrestAppsAgentTarget>$(MSBuildProjectDirectory)\.agents\</_CrestAppsAgentTarget>
  </PropertyGroup>

  <Target Name="_CrestAppsCopyAgentFiles"
          BeforeTargets="Restore;CollectPackageReferences;ResolvePackageAssets;PrepareForBuild;Build"
          Condition="Exists('$(_CrestAppsAgentSource)')">

    <ItemGroup>
      <_CrestAppsAgentFiles Include="$(_CrestAppsAgentSource)**\*" />
    </ItemGroup>

    <MakeDir Directories="$(_CrestAppsAgentTarget)" Condition="!Exists('$(_CrestAppsAgentTarget)')" />

    <Copy SourceFiles="@(_CrestAppsAgentFiles)"
          DestinationFiles="@(_CrestAppsAgentFiles->'$(_CrestAppsAgentTarget)%(RecursiveDir)%(Filename)%(Extension)')"
          OverwriteReadOnlyFiles="true"
          SkipUnchangedFiles="false" />

  </Target>

</Project>
